{% extends "base.html" %}
{% block content %}
<h4 class="mb-4"><i class="bi bi-plus-circle"></i> Nowa oferta — Konfigurator</h4>

<form method="post" action="/offers/new">
  <!-- Offer details -->
  <div class="card shadow-sm mb-4">
    <div class="card-header">Dane oferty</div>
    <div class="card-body">
      <div class="row g-3">
        <div class="col-md-6">
          <label class="form-label">Nazwa oferty / numer</label>
          <input class="form-control" type="text" name="name" required
                 placeholder="Np. OF-2025-042 Hala produkcyjna ABC">
        </div>
        <div class="col-md-6">
          <label class="form-label">Klient</label>
          <input class="form-control" type="text" name="client"
                 placeholder="Np. ABC Manufacturing Sp. z o.o.">
        </div>
        <div class="col-12">
          <label class="form-label">Notatki (opcjonalnie)</label>
          <textarea class="form-control" name="notes" rows="2"
                    placeholder="Dodatkowe uwagi do oferty"></textarea>
        </div>
      </div>
    </div>
  </div>

  <!-- Scope clauses -->
  <div class="card shadow-sm mb-4">
    <div class="card-header bg-success text-white">
      <i class="bi bi-check-circle"></i> Zakres prac — wybierz co oferta ZAWIERA
    </div>
    <div class="card-body">
      {% if scope_clauses %}
        {% for c in scope_clauses %}
        <div class="form-check mb-2">
          <input class="form-check-input" type="checkbox" name="clause_ids"
                 value="{{ c.id }}" id="scope_{{ c.id }}">
          <label class="form-check-label" for="scope_{{ c.id }}">
            {{ c.text }}
            {% if c.frequency > 1 %}
            <span class="badge text-bg-light text-muted">{{ c.frequency }}x</span>
            {% endif %}
          </label>
        </div>
        {% endfor %}
      {% else %}
        <p class="text-muted mb-0">Brak klauzul zakresu. <a href="/clauses">Dodaj w bazie klauzul</a>.</p>
      {% endif %}
    </div>
  </div>

  <!-- Exclusion clauses -->
  <div class="card shadow-sm mb-4">
    <div class="card-header bg-warning">
      <i class="bi bi-x-circle"></i> Wykluczenia — wybierz czego oferta NIE ZAWIERA
    </div>
    <div class="card-body">
      {% if excl_clauses %}
        {% for c in excl_clauses %}
        <div class="form-check mb-2 {% if c.is_critical %}border-start border-danger border-3 ps-3{% endif %}">
          <input class="form-check-input" type="checkbox" name="clause_ids"
                 value="{{ c.id }}" id="excl_{{ c.id }}"
                 {% if c.is_critical %}checked{% endif %}>
          <label class="form-check-label" for="excl_{{ c.id }}">
            {% if c.is_critical %}
            <i class="bi bi-exclamation-triangle-fill text-danger"></i>
            {% endif %}
            {{ c.text }}
            {% if c.frequency > 1 %}
            <span class="badge text-bg-light text-muted">{{ c.frequency }}x</span>
            {% endif %}
            {% if c.is_critical %}
            <span class="badge text-bg-danger">KRYTYCZNE</span>
            {% endif %}
          </label>
        </div>
        {% endfor %}
      {% else %}
        <p class="text-muted mb-0">Brak wykluczeń. <a href="/clauses">Dodaj w bazie klauzul</a>.</p>
      {% endif %}
    </div>
  </div>

  <div class="d-flex gap-2">
    <button class="btn btn-primary btn-lg" type="submit">
      <i class="bi bi-shield-check"></i> Utwórz ofertę i sprawdź bezpieczeństwo
    </button>
    <a href="/offers" class="btn btn-outline-secondary btn-lg">Anuluj</a>
  </div>
</form>
{% endblock %}
